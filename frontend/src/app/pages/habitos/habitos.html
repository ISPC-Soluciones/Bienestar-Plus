<main class="mis-habitos">
  <section class="rutinas">
    <div class="container__habitos">
      <div class="container__titulo__habitos">
        <h1>Hábitos de <span>Usuario</span></h1>
      </div>
      
      <div class="container__rutinas">
        <div class="container__tabs__rutinas">
          <div class="tabs">
            <div class="tab-buttons">
              <!-- Pestaña de Ejercicio -->
              <button class="tab-button" [class.active]="activeTab === 'ejercicio'" (click)="setActiveTab('ejercicio')">
                <i class="fa-solid fa-person-running"></i> Ejercicio
              </button>
              
              <!-- Pestaña de Hábitos Diarios (NUEVO) -->
              <button class="tab-button" [class.active]="activeTab === 'diario'" (click)="setActiveTab('diario')">
                <i class="fa-solid fa-clipboard-check"></i> Checklist Diario
              </button>
            </div>

            <!-- Contenido: Ejercicio y Rutina -->
            <div class="tab-content" [class.active]="activeTab === 'ejercicio'" id="ejercicio">
              
              <article class="card__presentacion__habito">
                <h3><i class="fa-solid fa-dumbbell"></i> Gestión de Rutina</h3>
                <p>Agrega o quita ejercicios de tu rutina personalizada.</p>
              </article>
              
              <div class="contenido__ejercicios">
                
                <h3>Ejercicios disponibles</h3>
                <div class="grid-ejercicios">
                  @for (ej of ejerciciosDisponibles; track ej.id) {
                  <article class="card__habito">
                    <h4 class="card__habito__titulo">{{ ej.nombre }}</h4>
                    <p class="card__habito__descripcion">{{ ej.descripcion }}</p>

                    <div class="card__habito__acciones">
                      <!-- Botón Agregar (solo visible si NO está en la rutina) -->
                      @if (!estaEnRutina(ej)) {
                      <button
                        class="btn-custom btn-custom--primario"
                        (click)="agregarEjercicio(ej)"
                      >
                        Agregar <i class="fa-solid fa-plus"></i>
                      </button>
                      }
                      
                      <!-- Botón Quitar (solo visible si SÍ está en la rutina) -->
                      @if (estaEnRutina(ej)) {
                      <button
                        class="btn-custom btn-custom--rojo"
                        (click)="eliminarDeRutina(getRutinaPorEjercicio(ej.id)!)" 
                        >
                        Quitar <i class="fa-solid fa-trash"></i>
                      </button>
                      }
                    </div>
                  </article>
                  }
                  @empty {
                    <p>No se encontraron ejercicios disponibles. Vuelve más tarde.</p>
                  }
                </div>

                <hr style="margin: 20px 0;">
                
                <div class="listado__rutina">
                    <h3>Mi rutina de hoy (Checklist de Ejercicios)</h3>
                    <button class="btn-custom btn-custom--secundario" (click)="toggleRutina()">
                      {{ mostrarRutina ? 'Ocultar' : 'Ver' }} Checklist
                    </button>
                    
                    @if (mostrarRutina) {
                    <ul class="checklist-list">
                      @for (rutina of rutinaUsuario; track rutina.id) {
                      <li [class.completado]="rutina.completado">
                        <label>
                          <input
                            type="checkbox"
                            [(ngModel)]="rutina.completado"
                            (change)="marcarCompletado(rutina)"
                          />
                          {{ rutina.ejercicio.nombre }}
                        </label>
                      </li>
                      }
                      @empty {
                          <li class="empty-list">Tu rutina está vacía. Agrega ejercicios arriba.</li>
                      }
                    </ul>
                    }
                </div>
              </div>
            </div>
            
            <!-- Contenido: Hábitos Diarios (NUEVO) -->
            <div class="tab-content" [class.active]="activeTab === 'diario'" id="diario">
              <article class="card__presentacion__habito">
                <h3><i class="fa-solid fa-heart-circle-check"></i> Hábitos de Bienestar Diario</h3>
                <p>Marca tus objetivos diarios de salud y bienestar.</p>
              </article>
              
              <div class="listado__progreso">
                <h3>Checklist de Hoy</h3>
                
                @if (progresosDiarios.length > 0) {
                <ul class="checklist-list">
                  @for (progreso of progresosDiarios; track progreso.id) {
                  <li [class.completado]="progreso.completado">
                    <label>
                      <input
                        type="checkbox"
                        [(ngModel)]="progreso.completado"
                        (change)="marcarProgresoDiario(progreso)"
                      />
                      {{ progreso.habito.nombre }} 
                      <small>({{ progreso.habito.descripcion }})</small>
                    </label>
                  </li>
                  }
                </ul>
                } @else {
                  <p class="empty-list">No hay hábitos diarios asignados para hoy.</p>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>